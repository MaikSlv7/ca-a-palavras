<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caça-Palavras Infinito</title>
  <link rel="manifest" href="manifest.json" />
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      background: #000;
      color: #0ff;
      font-family: monospace;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1#titulo {
      font-family: 'Press Start 2P', monospace;
      color: #0ff;
      text-shadow: 0 0 10px #0ff, 0 0 20px #0ff, 0 0 30px #0ff;
      animation: brilho 2s infinite alternate;
    }
    @keyframes brilho {
      0% { text-shadow: 0 0 5px #0ff; }
      100% { text-shadow: 0 0 20px #0ff, 0 0 30px #0ff; }
    }
    #fase, #cronometro { margin: 10px 0; }
    #tabuleiro {
      display: grid;
      grid-template-columns: repeat(12, 30px);
      gap: 2px;
      justify-content: center;
    }
    .letra {
      width: 30px;
      height: 30px;
      background: #111;
      color: #0ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      user-select: none;
      touch-action: none;
    }
    .selected { background: #0ff; color: #000; }
    .found { background: #0a0; color: #fff; }
    input, button {
      padding: 10px;
      margin: 5px;
      background: #000;
      border: 2px solid #0ff;
      color: #0ff;
    }
  </style>
</head>
<body>
  <h1 id="titulo">CAÇA-PALAVRAS</h1>
  <div id="inicio">
    <label>Nome: <input id="nomeJogador" /></label><br>
    <button onclick="iniciarJogo()">Iniciar Jogo</button>
  </div>
  <div id="fase"></div>
  <div id="cronometro"></div>
  <div id="lista"></div>
  <div id="tabuleiro"></div>
  <div id="fim" style="display:none;">
    <h2>Fim de Jogo</h2>
    <p id="pontuacaoFinal"></p>
    <button onclick="iniciarJogo()">Jogar Novamente</button>
  </div>
  <script>
    const banco = ["LUZ","VIDA","PAZ","FÉ","GATO","AMOR","FORCA","SOL","ENERGIA","ESCOLA",
      "SONHAR","FUTURO","ESPERANÇA","LIBERDADE","CORAGEM","JUSTIÇA",
      "TRANSFORMAÇÃO","CONHECIMENTO","INSPIRAÇÃO","EVOLUÇÃO"];

    let fase = 1, tempo = 90, intervalo;
    let palavras = [], grade = [], encontradas = [], selecao = [], selecionando = false;

    function gerarPalavrasAleatorias(qtd = 4) {
      const sorteadas = [];
      while (sorteadas.length < qtd) {
        const p = banco[Math.floor(Math.random() * banco.length)];
        if (!sorteadas.includes(p)) sorteadas.push(p);
      }
      return sorteadas;
    }

    function iniciarJogo() {
      document.getElementById("titulo").style.display = "none";
      document.getElementById("inicio").style.display = "none";
      document.getElementById("fim").style.display = "none";
      fase = 1;
      iniciarFase();
    }

    function iniciarFase() {
      palavras = gerarPalavrasAleatorias();
      grade = Array.from({ length: 12 }, () => Array(12).fill(""));
      encontradas = []; selecao = [];
      document.getElementById("fase").textContent = "FASE " + fase;
      inserirPalavras(); preencher(); desenhar(); atualizarLista();
      iniciarCronometro();
    }

    function inserirPalavras() {
      const d = [{dx:0,dy:1},{dx:1,dy:0},{dx:1,dy:1}];
      palavras.forEach(p => {
        let ok = false;
        while (!ok) {
          const dir = d[Math.floor(Math.random()*d.length)];
          const x = Math.floor(Math.random()*12), y = Math.floor(Math.random()*12);
          if (x + dir.dx * p.length > 12 || y + dir.dy * p.length > 12) continue;
          let pode = true;
          for (let i = 0; i < p.length; i++) {
            const nx = x + i * dir.dx, ny = y + i * dir.dy;
            if (grade[nx][ny] && grade[nx][ny] !== p[i]) { pode = false; break; }
          }
          if (pode) {
            for (let i = 0; i < p.length; i++) {
              grade[x + i * dir.dx][y + i * dir.dy] = p[i];
            }
            ok = true;
          }
        }
      });
    }

    function preencher() {
      const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      for (let i=0;i<12;i++) for (let j=0;j<12;j++)
        if (!grade[i][j]) grade[i][j] = letras[Math.floor(Math.random()*letras.length)];
    }

    function desenhar() {
      const t = document.getElementById("tabuleiro"); t.innerHTML = "";
      for (let i=0;i<12;i++) for (let j=0;j<12;j++) {
        const c = document.createElement("div");
        c.className = "letra"; c.textContent = grade[i][j];
        c.dataset.x = i; c.dataset.y = j;
        c.addEventListener("pointerdown",()=>iniciarSelecao(c));
        c.addEventListener("pointerenter",()=>expandirSelecao(c));
        c.addEventListener("pointerup",finalizarSelecao);
        c.addEventListener("touchstart",()=>iniciarSelecao(c));
        c.addEventListener("touchmove",e=>{
          const t = e.touches[0];
          const alvo = document.elementFromPoint(t.clientX, t.clientY);
          if (alvo && alvo.classList.contains("letra")) expandirSelecao(alvo);
        });
        c.addEventListener("touchend",finalizarSelecao);
        t.appendChild(c);
      }
    }

    function iniciarSelecao(cel) {
      selecionando = true; selecao = [cel]; cel.classList.add("selected");
    }

    function expandirSelecao(cel) {
      if (!selecionando || selecao.includes(cel)) return;
      selecao.push(cel); cel.classList.add("selected");
    }

    function finalizarSelecao() {
      if (!selecionando) return;
      selecionando = false;
      const palavra = selecao.map(c=>c.textContent).join('');
      const invertida = selecao.map(c=>c.textContent).reverse().join('');
      if (palavras.includes(palavra) || palavras.includes(invertida)) {
        selecao.forEach(c=>c.classList.add("found"));
        if (!encontradas.includes(palavra)) {
          encontradas.push(palavra);
          tempo += 10;
        }
      }
      selecao.forEach(c=>c.classList.remove("selected"));
      selecao = [];
      atualizarLista();
      if (encontradas.length === palavras.length) {
        fase++;
        clearInterval(intervalo);
        setTimeout(iniciarFase, 1000);
      }
    }

    function atualizarLista() {
      document.getElementById("lista").innerHTML = palavras.map(p =>
        encontradas.includes(p) ? `<s>${p}</s>` : p
      ).join(" - ");
    }

    function iniciarCronometro() {
      tempo = 90;
      atualizarTempo();
      clearInterval(intervalo);
      intervalo = setInterval(() => {
        tempo--;
        atualizarTempo();
        if (tempo <= 0) fimDeJogo();
      }, 1000);
    }

    function atualizarTempo() {
      const m = String(Math.floor(tempo / 60)).padStart(2, '0');
      const s = String(tempo % 60).padStart(2, '0');
      document.getElementById("cronometro").textContent = `⏱️ ${m}:${s}`;
    }

    function fimDeJogo() {
      clearInterval(intervalo);
      document.getElementById("fim").style.display = "block";
      document.getElementById("tabuleiro").style.display = "none";
      document.getElementById("pontuacaoFinal").textContent = `Você chegou até a fase ${fase} e marcou ${encontradas.length * fase * 10} pontos!`;
    }
  </script>
</body>
</html>